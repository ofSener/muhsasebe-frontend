<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Komisyon Kuralları - IHSAN AI</title>
  <link rel="stylesheet" href="../../assets/css/main.css">
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <style>
    /* ═══════════════════════════════════════════════════════════════
       COMMISSION GROUPS GRID
       ═══════════════════════════════════════════════════════════════ */
    .groups-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.25rem;
      margin-bottom: 1.5rem;
    }

    .group-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      cursor: pointer;
      transition: all var(--transition-base);
      box-shadow: var(--card-shadow);
      position: relative;
      overflow: hidden;
    }

    .group-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--card-shadow-hover);
      border-color: var(--primary);
    }

    .group-card.active {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-glow);
    }

    .group-card-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .group-card-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-md);
      background: var(--primary-glow);
      color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .group-card-icon svg {
      width: 24px;
      height: 24px;
    }

    .group-card-actions {
      display: flex;
      gap: 0.25rem;
      opacity: 0;
      transition: opacity var(--transition-fast);
    }

    .group-card:hover .group-card-actions {
      opacity: 1;
    }

    .group-card-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .group-card-desc {
      font-size: 0.8125rem;
      color: var(--text-muted);
      margin-bottom: 1rem;
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .group-card-stats {
      display: flex;
      gap: 1.5rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border-subtle);
    }

    .group-stat {
      display: flex;
      flex-direction: column;
    }

    .group-stat-value {
      font-size: 1.25rem;
      font-weight: 700;
      font-family: var(--font-mono);
      color: var(--text-primary);
    }

    .group-stat-label {
      font-size: 0.6875rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    /* Add New Group Card */
    .group-card-add {
      border: 2px dashed var(--border-default);
      background: transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 180px;
      color: var(--text-muted);
    }

    .group-card-add:hover {
      border-color: var(--primary);
      color: var(--primary);
      background: var(--primary-glow);
    }

    .group-card-add svg {
      width: 32px;
      height: 32px;
      margin-bottom: 0.5rem;
    }

    .group-card-add span {
      font-weight: 600;
      font-size: 0.875rem;
    }

    /* ═══════════════════════════════════════════════════════════════
       RULES LIST
       ═══════════════════════════════════════════════════════════════ */
    .rules-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .rule-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: var(--bg-elevated);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      transition: all var(--transition-fast);
    }

    .rule-item:hover {
      border-color: var(--border-default);
      background: var(--bg-surface);
    }

    .rule-info {
      flex: 1;
      display: grid;
      grid-template-columns: 1fr 1fr 2fr 100px;
      gap: 1rem;
      align-items: center;
    }

    @media (max-width: 900px) {
      .rule-info {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }
    }

    .rule-company, .rule-branch {
      display: flex;
      flex-direction: column;
    }

    .rule-label {
      font-size: 0.6875rem;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.03em;
      margin-bottom: 0.125rem;
    }

    .rule-value {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .rule-condition {
      display: flex;
      flex-direction: column;
    }

    .rule-condition-text {
      font-size: 0.8125rem;
      font-family: var(--font-mono);
      color: var(--text-secondary);
      background: var(--bg-surface);
      padding: 0.375rem 0.625rem;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-subtle);
    }

    .rule-rate {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    .rule-rate-value {
      font-size: 1.125rem;
      font-weight: 700;
      font-family: var(--font-mono);
      color: var(--success);
    }

    .rule-actions {
      display: flex;
      gap: 0.25rem;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem 2rem;
      color: var(--text-muted);
    }

    .empty-state-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 1rem;
      color: var(--text-dim);
    }

    .empty-state-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .empty-state-desc {
      font-size: 0.875rem;
      margin-bottom: 1.5rem;
    }

    /* ═══════════════════════════════════════════════════════════════
       MEMBERS LIST
       ═══════════════════════════════════════════════════════════════ */
    .members-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .member-chip {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: 100px;
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--text-primary);
      transition: all var(--transition-fast);
    }

    .member-chip:hover {
      border-color: var(--danger);
      background: var(--danger-bg);
    }

    .member-chip .avatar {
      width: 24px;
      height: 24px;
      font-size: 0.625rem;
    }

    .member-chip .remove-btn {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: transparent;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
      margin-left: 0.25rem;
    }

    .member-chip .remove-btn:hover {
      background: var(--danger);
      color: white;
    }

    .member-chip .remove-btn svg {
      width: 12px;
      height: 12px;
    }

    /* ═══════════════════════════════════════════════════════════════
       MODAL STYLES
       ═══════════════════════════════════════════════════════════════ */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
    }

    .modal-backdrop.active {
      display: flex;
    }

    .modal {
      background: var(--bg-surface);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-lg);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
      width: 100%;
      max-height: 90vh;
      overflow: hidden;
      animation: modalIn 0.2s ease-out;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .modal::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--primary), var(--cyan), var(--emerald));
    }

    .modal-sm { max-width: 400px; }
    .modal-md { max-width: 600px; }
    .modal-lg { max-width: 900px; }
    .modal-xl { max-width: 1100px; }

    @keyframes modalIn {
      from { opacity: 0; transform: scale(0.95) translateY(-10px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--border-subtle);
      flex-shrink: 0;
    }

    .modal-title {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-md);
      background: transparent;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
    }

    .modal-close:hover {
      background: var(--bg-elevated);
      color: var(--text-primary);
    }

    .modal-close svg {
      width: 20px;
      height: 20px;
    }

    .modal-body {
      padding: 1.5rem;
      overflow-y: auto;
      flex: 1;
    }

    .modal-footer {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 0.75rem;
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border-subtle);
      background: var(--bg-elevated);
      flex-shrink: 0;
    }

    /* ═══════════════════════════════════════════════════════════════
       CUSTOM DROPDOWN STYLES
       ═══════════════════════════════════════════════════════════════ */
    .custom-select-wrapper {
      position: relative;
      width: 100%;
    }

    .custom-select-trigger {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: var(--bg-elevated);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s ease;
      user-select: none;
    }

    .custom-select-trigger:hover {
      border-color: var(--primary);
      background: var(--bg-overlay);
    }

    .custom-select-wrapper.open .custom-select-trigger {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-glow);
    }

    .custom-select-trigger svg {
      width: 18px;
      height: 18px;
      color: var(--text-muted);
      transition: transform 0.2s ease;
      flex-shrink: 0;
    }

    .custom-select-wrapper.open .custom-select-trigger svg {
      transform: rotate(180deg);
      color: var(--primary);
    }

    .custom-select-trigger span {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .custom-select-dropdown {
      position: absolute;
      top: calc(100% + 4px);
      left: 0;
      right: 0;
      background: var(--bg-surface);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-md);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      max-height: 280px;
      overflow-y: auto;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: all 0.2s ease;
    }

    .custom-select-wrapper.open .custom-select-dropdown {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .custom-select-option {
      padding: 0.625rem 1rem;
      color: var(--text-secondary);
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.15s ease;
      border-left: 3px solid transparent;
    }

    .custom-select-option:hover {
      background: var(--bg-elevated);
      color: var(--text-primary);
      border-left-color: var(--primary);
    }

    .custom-select-option.selected {
      background: var(--primary-glow);
      color: var(--primary);
      font-weight: 600;
      border-left-color: var(--primary);
    }

    .custom-select-search {
      padding: 0.5rem;
      border-bottom: 1px solid var(--border-subtle);
      position: sticky;
      top: 0;
      background: var(--bg-surface);
    }

    .custom-select-search input {
      width: 100%;
      padding: 0.5rem 0.75rem;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 0.8125rem;
    }

    .custom-select-search input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .custom-select-search input::placeholder {
      color: var(--text-muted);
    }

    .custom-select-empty {
      padding: 1rem;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.8125rem;
    }

    /* Hidden native select */
    .custom-select-wrapper select {
      display: none;
    }

    /* Modal içi native select (koşul için) */
    .modal .form-select {
      appearance: none;
      -webkit-appearance: none;
      background-color: var(--bg-elevated);
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.5rem center;
      background-size: 1rem;
      padding: 0.625rem 2rem 0.625rem 0.75rem;
      border: 1px solid var(--border-default);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .modal .form-select:hover {
      border-color: var(--primary);
    }

    .modal .form-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-glow);
    }

    .modal .form-select option {
      background: var(--bg-surface);
      color: var(--text-primary);
    }

    /* Modal içi form input stilleri */
    .modal .form-input {
      background-color: var(--bg-elevated);
      border: 1px solid var(--border-default);
      color: var(--text-primary);
      padding: 0.625rem 0.75rem;
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }

    .modal .form-input:hover {
      border-color: var(--primary);
    }

    .modal .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-glow);
    }

    .modal .form-input::placeholder {
      color: var(--text-muted);
    }

    /* Modal form label */
    .modal .form-label {
      color: var(--text-secondary);
      font-size: 0.8125rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    /* Modal form hint */
    .modal .form-hint {
      color: var(--text-muted);
      font-size: 0.75rem;
      margin-top: 0.5rem;
    }

    /* Section badge gradient */
    .section-badge {
      background: linear-gradient(135deg, var(--primary), var(--cyan));
      color: white;
    }

    /* Rate input group */
    .modal .rate-input-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .modal .rate-input-group input {
      width: 100px;
      text-align: center;
    }

    .modal .rate-input-group span {
      color: var(--primary);
      font-weight: 600;
      font-size: 1rem;
    }

    /* Condition builder spacing */
    .modal .condition-builder {
      display: flex;
      gap: 0.75rem;
      align-items: flex-end;
      flex-wrap: wrap;
    }

    .modal .condition-builder .form-group {
      margin-bottom: 0;
    }

    /* Confirm modal özel stili */
    #confirmModal .modal::before {
      background: linear-gradient(90deg, var(--danger), #f87171, var(--danger));
    }

    /* ═══════════════════════════════════════════════════════════════
       FORM STYLES
       ═══════════════════════════════════════════════════════════════ */
    .form-row {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    @media (max-width: 600px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }

    .form-row-3 {
      grid-template-columns: repeat(3, 1fr);
    }

    @media (max-width: 768px) {
      .form-row-3 {
        grid-template-columns: 1fr;
      }
    }

    .condition-builder {
      display: flex;
      gap: 0.75rem;
      align-items: flex-end;
      flex-wrap: wrap;
    }

    .condition-builder .form-group {
      margin-bottom: 0;
    }

    .condition-builder .field-select {
      min-width: 160px;
    }

    .condition-builder .operator-select {
      min-width: 80px;
    }

    .condition-builder .value-input {
      min-width: 120px;
      max-width: 120px;
    }

    /* Condition builder içindeki tüm form elemanlarını aynı yükseklikte tut */
    .condition-builder .form-select,
    .condition-builder .form-input {
      height: 38px;
      line-height: 38px;
      padding-top: 0;
      padding-bottom: 0;
    }

    /* Rate Input */
    .rate-input-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .rate-input-group input {
      width: 100px;
      text-align: center;
      font-family: var(--font-mono);
      font-weight: 600;
    }

    .rate-input-group span {
      font-weight: 600;
      color: var(--text-secondary);
    }

    /* ═══════════════════════════════════════════════════════════════
       MEMBER SELECTOR MODAL
       ═══════════════════════════════════════════════════════════════ */
    .member-selector-search {
      margin-bottom: 1rem;
    }

    .member-selector-search .search-box {
      position: relative;
      display: flex;
      align-items: center;
    }

    .member-selector-search .search-icon {
      position: absolute;
      left: 0.75rem;
      width: 18px;
      height: 18px;
      color: var(--text-muted);
      pointer-events: none;
    }

    .member-selector-search .form-input {
      padding-left: 2.5rem;
      width: 100%;
    }

    .member-selector-list {
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
    }

    .member-selector-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--border-subtle);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .member-selector-item:last-child {
      border-bottom: none;
    }

    .member-selector-item:hover {
      background: var(--bg-elevated);
    }

    .member-selector-item.selected {
      background: var(--primary-glow);
    }

    .member-selector-item .checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border-default);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all var(--transition-fast);
    }

    .member-selector-item.selected .checkbox {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }

    .member-selector-item .checkbox svg {
      width: 14px;
      height: 14px;
      opacity: 0;
    }

    .member-selector-item.selected .checkbox svg {
      opacity: 1;
    }

    .member-selector-item .member-info {
      flex: 1;
    }

    .member-selector-item .member-name {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 0.875rem;
    }

    .member-selector-item .member-email {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* ═══════════════════════════════════════════════════════════════
       LOADING STATES
       ═══════════════════════════════════════════════════════════════ */
    .skeleton {
      background: linear-gradient(90deg, var(--bg-elevated) 25%, var(--bg-overlay) 50%, var(--bg-elevated) 75%);
      background-size: 200% 100%;
      animation: skeleton-loading 1.5s infinite;
      border-radius: var(--radius-sm);
    }

    @keyframes skeleton-loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .skeleton-card {
      height: 180px;
    }

    .btn-loading {
      position: relative;
      color: transparent !important;
    }

    .btn-loading::after {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      border: 2px solid transparent;
      border-top-color: currentColor;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
      top: 50%;
      left: 50%;
      margin-top: -8px;
      margin-left: -8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ═══════════════════════════════════════════════════════════════
       SECTION HEADERS
       ═══════════════════════════════════════════════════════════════ */
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border-subtle);
    }

    .section-title {
      font-size: 0.9375rem;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .section-title svg {
      width: 18px;
      height: 18px;
      color: var(--primary);
    }

    .section-badge {
      background: var(--bg-overlay);
      color: var(--text-secondary);
      padding: 0.125rem 0.5rem;
      border-radius: 100px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    /* ═══════════════════════════════════════════════════════════════
       RESPONSIVE ADJUSTMENTS
       ═══════════════════════════════════════════════════════════════ */
    @media (max-width: 768px) {
      .groups-grid {
        grid-template-columns: 1fr;
      }

      .modal {
        margin: 0.5rem;
        max-height: calc(100vh - 1rem);
      }

      .rule-item {
        flex-direction: column;
        align-items: stretch;
      }

      .rule-actions {
        justify-content: flex-end;
        padding-top: 0.75rem;
        border-top: 1px solid var(--border-subtle);
      }
    }
  </style>
</head>
<body>
  <div class="gradient-mesh"></div>
  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar"></aside>

    <!-- Main Content -->
    <main class="main-content">
      <nav class="navbar">
        <div class="navbar-left">
          <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Menu">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </button>
          <div class="navbar-breadcrumb">
            <span class="breadcrumb-item">Yönetim</span>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-item active">Komisyon Kuralları</span>
          </div>
        </div>
        <div class="navbar-right">
          <button class="navbar-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/>
              <path d="M13.73 21a2 2 0 01-3.46 0"/>
            </svg>
            <span class="badge">3</span>
          </button>
          <div class="navbar-divider"></div>
          <div class="navbar-user">
            <div class="navbar-avatar"></div>
            <div class="navbar-user-info">
              <div class="navbar-user-name">Yükleniyor...</div>
              <div class="navbar-user-role"></div>
            </div>
          </div>
        </div>
      </nav>

      <!-- Page Wrapper -->
      <div class="page-wrapper">
        <div class="page-content">
          <!-- Page Header -->
          <div class="page-header">
            <div>
              <h1 class="page-title">Komisyon Kuralları</h1>
              <p class="page-subtitle">Çalışan gruplarının komisyon oranlarını ve kurallarını yönetin.</p>
            </div>
            <div class="page-actions">
              <button class="btn btn-primary" onclick="openGroupModal()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"/>
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Yeni Grup Oluştur
              </button>
            </div>
          </div>

          <!-- Stats Cards -->
          <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 1.5rem;">
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon cyan">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 00-3-3.87"/>
                    <path d="M16 3.13a4 4 0 010 7.75"/>
                  </svg>
                </div>
              </div>
              <div class="stat-value" id="statTotalGroups">-</div>
              <div class="stat-label">Toplam Grup</div>
            </div>
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon emerald">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                    <polyline points="14,2 14,8 20,8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                  </svg>
                </div>
              </div>
              <div class="stat-value" id="statTotalRules">-</div>
              <div class="stat-label">Toplam Kural</div>
            </div>
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon violet">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                  </svg>
                </div>
              </div>
              <div class="stat-value" id="statTotalMembers">-</div>
              <div class="stat-label">Atanmış Üye</div>
            </div>
          </div>

          <!-- Commission Groups Grid -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Komisyon Grupları</h3>
              <div class="card-actions">
                <span class="text-muted" id="groupsCount">Yüklüyor...</span>
              </div>
            </div>
            <div class="card-body">
              <div class="groups-grid" id="groupsGrid">
                <!-- Groups will be loaded here -->
                <div class="skeleton skeleton-card"></div>
                <div class="skeleton skeleton-card"></div>
                <div class="skeleton skeleton-card"></div>
              </div>
            </div>
          </div>

          <!-- Info Alert -->
          <div class="alert alert-info" style="margin-top: 1.5rem;">
            <div class="alert-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
              </svg>
            </div>
            <div class="alert-content">
              <div class="alert-title">Komisyon Hesaplama Mantığı</div>
              <div class="alert-text">En spesifik kural önceliklidir: Şirket+Branş > Sadece Şirket > Sadece Branş > Varsayılan. Aynı öncelik seviyesinde yüksek eşik değeri olan kural önce kontrol edilir (örneğin: 10.000 TL kuralı, 5.000 TL kuralından önce).</div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- ═══════════════════════════════════════════════════════════════
       GROUP DETAIL MODAL
       ═══════════════════════════════════════════════════════════════ -->
  <div class="modal-backdrop" id="groupDetailModal">
    <div class="modal modal-xl">
      <div class="modal-header">
        <h3 class="modal-title" id="groupDetailTitle">Grup Detayı</h3>
        <button class="modal-close" onclick="closeGroupDetailModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <!-- Group Info Form -->
        <div class="card" style="margin-bottom: 1.5rem;">
          <div class="card-body">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Grup Adı</label>
                <input type="text" class="form-input" id="groupDetailName" placeholder="Örneğin: Kıdemli Acenteler">
              </div>
              <div class="form-group">
                <label class="form-label">Açıklama</label>
                <input type="text" class="form-input" id="groupDetailDesc" placeholder="Grup hakkında kısa açıklama">
              </div>
            </div>
            <div style="display: flex; justify-content: flex-end; margin-top: 0.5rem;">
              <button class="btn btn-secondary btn-sm" onclick="updateGroupInfo()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                  <polyline points="17,21 17,13 7,13 7,21"/>
                  <polyline points="7,3 7,8 15,8"/>
                </svg>
                Bilgileri Kaydet
              </button>
            </div>
          </div>
        </div>

        <!-- Rules Section -->
        <div class="card" style="margin-bottom: 1.5rem;">
          <div class="card-body">
            <div class="section-header">
              <div class="section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                  <polyline points="14,2 14,8 20,8"/>
                </svg>
                Komisyon Kuralları
                <span class="section-badge" id="rulesCount">0</span>
              </div>
              <button class="btn btn-primary btn-sm" onclick="openRuleModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"/>
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Kural Ekle
              </button>
            </div>
            <div class="rules-list" id="rulesList">
              <!-- Rules will be loaded here -->
            </div>
          </div>
        </div>

        <!-- Members Section -->
        <div class="card">
          <div class="card-body">
            <div class="section-header">
              <div class="section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                  <path d="M23 21v-2a4 4 0 00-3-3.87"/>
                  <path d="M16 3.13a4 4 0 010 7.75"/>
                </svg>
                Grup Üyeleri
                <span class="section-badge" id="membersCount">0</span>
              </div>
              <button class="btn btn-secondary btn-sm" onclick="openMemberSelectorModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                  <circle cx="8.5" cy="7" r="4"/>
                  <line x1="20" y1="8" x2="20" y2="14"/>
                  <line x1="23" y1="11" x2="17" y2="11"/>
                </svg>
                Üye Ekle
              </button>
            </div>
            <div class="members-grid" id="membersList">
              <!-- Members will be loaded here -->
            </div>
          </div>
        </div>

        <!-- Branches (Şubeler) Section -->
        <div class="card">
          <div class="card-body">
            <div class="section-header">
              <div class="section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                  <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
                Grup Şubeleri
                <span class="section-badge" id="branchesCount">0</span>
              </div>
              <button class="btn btn-secondary btn-sm" onclick="openBranchSelectorModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                  <line x1="12" y1="9" x2="12" y2="15"/>
                  <line x1="15" y1="12" x2="9" y2="12"/>
                </svg>
                Şube Ekle
              </button>
            </div>
            <div class="members-grid" id="branchesList">
              <!-- Branches will be loaded here -->
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="justify-content: space-between;">
        <button class="btn btn-danger" onclick="deleteGroup()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
          </svg>
          Grubu Sil
        </button>
        <button class="btn btn-primary" onclick="updateGroupInfo(); closeGroupDetailModal();">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          Kaydet
        </button>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════════════════════════
       GROUP CREATE/EDIT MODAL
       ═══════════════════════════════════════════════════════════════ -->
  <div class="modal-backdrop" id="groupModal">
    <div class="modal modal-md">
      <div class="modal-header">
        <h3 class="modal-title" id="groupModalTitle">Yeni Grup Oluştur</h3>
        <button class="modal-close" onclick="closeGroupModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="groupForm">
          <div class="form-group">
            <label class="form-label">Grup Adı *</label>
            <input type="text" class="form-input" id="groupName" placeholder="Örneğin: Kıdemli Acenteler" required>
          </div>
          <div class="form-group">
            <label class="form-label">Açıklama</label>
            <textarea class="form-textarea" id="groupDescription" placeholder="Grup hakkında kısa açıklama..." rows="3"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeGroupModal()">İptal</button>
        <button class="btn btn-primary" id="groupSubmitBtn" onclick="saveGroup()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          Oluştur
        </button>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════════════════════════
       RULE EDITOR MODAL
       ═══════════════════════════════════════════════════════════════ -->
  <div class="modal-backdrop" id="ruleModal">
    <div class="modal modal-lg">
      <div class="modal-header">
        <h3 class="modal-title" id="ruleModalTitle">Yeni Kural Ekle</h3>
        <button class="modal-close" onclick="closeRuleModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="ruleForm">
          <!-- Company & Branch -->
          <div class="form-row" style="margin-bottom: 1rem;">
            <div class="form-group">
              <label class="form-label">Sigorta Şirketi</label>
              <div id="ruleCompanyContainer" data-value=""></div>
              <span class="form-hint">Boş bırakırsanız tüm şirketler için geçerli olur</span>
            </div>
            <div class="form-group">
              <label class="form-label">Branş</label>
              <div id="ruleBranchContainer" data-value=""></div>
              <span class="form-hint">Boş bırakırsanız tüm branşlar için geçerli olur</span>
            </div>
          </div>

          <!-- Condition Builder -->
          <div class="form-group" style="margin-bottom: 1rem;">
            <label class="form-label">Koşul (Opsiyonel)</label>
            <div class="condition-builder">
              <div class="form-group field-select">
                <select class="form-select" id="ruleConditionField">
                  <option value="">Koşul Yok</option>
                  <option value="brutPrim">Brüt Prim</option>
                  <option value="netPrim">Net Prim</option>
                  <option value="komisyon">Komisyon Tutarı</option>
                </select>
              </div>
              <div class="form-group operator-select">
                <select class="form-select" id="ruleConditionOperator" disabled>
                  <option value=">">&gt;</option>
                  <option value="<">&lt;</option>
                  <option value=">=">&gt;=</option>
                  <option value="<=">&lt;=</option>
                  <option value="=">=</option>
                </select>
              </div>
              <div class="form-group value-input">
                <input type="number" class="form-input" id="ruleConditionValue" placeholder="Değer" disabled>
              </div>
              <span style="color: var(--text-muted); font-size: 0.875rem;">TL</span>
            </div>
            <span class="form-hint">Örneğin: Brüt Prim > 10000 TL olan poliçeler için</span>
          </div>

          <!-- Commission Rate -->
          <div class="form-group">
            <label class="form-label">Komisyon Oranı *</label>
            <div class="rate-input-group">
              <input type="number" class="form-input" id="ruleRate" min="0" max="100" step="0.1" placeholder="0" required>
              <span>%</span>
            </div>
            <span class="form-hint">0 ile 100 arasında bir değer girin</span>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeRuleModal()">İptal</button>
        <button class="btn btn-primary" id="ruleSubmitBtn" onclick="saveRule()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          Kaydet
        </button>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════════════════════════
       MEMBER SELECTOR MODAL
       ═══════════════════════════════════════════════════════════════ -->
  <div class="modal-backdrop" id="memberSelectorModal">
    <div class="modal modal-md">
      <div class="modal-header">
        <h3 class="modal-title">Üye Ekle</h3>
        <button class="modal-close" onclick="closeMemberSelectorModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="member-selector-search">
          <div class="search-box">
            <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <line x1="21" y1="21" x2="16.65" y2="16.65"/>
            </svg>
            <input type="text" class="form-input" id="memberSearchInput" placeholder="Çalışan ara..." oninput="filterMembers()">
          </div>
        </div>
        <div class="member-selector-list" id="memberSelectorList">
          <!-- Members will be loaded here -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeMemberSelectorModal()">İptal</button>
        <button class="btn btn-primary" id="addMembersBtn" onclick="addSelectedMembers()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          Seçilenleri Ekle
        </button>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════════════════════════
       BRANCH SELECTOR MODAL
       ═══════════════════════════════════════════════════════════════ -->
  <div class="modal-backdrop" id="branchSelectorModal">
    <div class="modal modal-md">
      <div class="modal-header">
        <h3 class="modal-title">Şube Ekle</h3>
        <button class="modal-close" onclick="closeBranchSelectorModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="member-selector-search">
          <div class="search-box">
            <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <line x1="21" y1="21" x2="16.65" y2="16.65"/>
            </svg>
            <input type="text" class="form-input" id="branchSearchInput" placeholder="Şube ara..." oninput="filterBranches()">
          </div>
        </div>
        <div class="member-selector-list" id="branchSelectorList">
          <!-- Branches will be loaded here -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeBranchSelectorModal()">İptal</button>
        <button class="btn btn-primary" id="addBranchesBtn" onclick="addSelectedBranches()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          Seçilenleri Ekle
        </button>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════════════════════════
       CONFIRM DELETE MODAL
       ═══════════════════════════════════════════════════════════════ -->
  <div class="modal-backdrop" id="confirmModal">
    <div class="modal modal-sm">
      <div class="modal-header">
        <h3 class="modal-title" id="confirmTitle">Onay</h3>
        <button class="modal-close" onclick="closeConfirmModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <p id="confirmMessage">Bu işlemi gerçekleştirmek istediğinizden emin misiniz?</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeConfirmModal()">İptal</button>
        <button class="btn btn-danger" id="confirmBtn" onclick="confirmAction()">Sil</button>
      </div>
    </div>
  </div>

  <script src="../../assets/js/config.js"></script>
  <script src="../../assets/js/app.js"></script>
  <script src="../../assets/js/pages/employees/commission.js"></script>
  <script src="../../components/base.js"></script>
  <script src="../../components/toast.js"></script>
  <script src="../../components/modal.js"></script>
  <script src="../../components/sidebar.js"></script>
</body>
</html>
